trigger:
- main

pool:
  name: Default  # your self-hosted agent pool

variables:
  azureSubscription: 'myserv'  # Azure DevOps Service Connection name
  webAppName: 'pythondeploy'       # Name of your Azure Web App
  resourceGroup: 'pythonR' # Resource Group of your Web App
  packagePath: '$(System.DefaultWorkingDirectory)'  # Path to deploy

steps:
# 1️⃣ Verify Python installation
- script: |
    python --version
    where python
    pip --version
  displayName: 'Verify Python 3.12'

# 2️⃣ Upgrade pip and install dependencies
- script: |
    python -m pip install --upgrade pip
    pip install -r requirements.txt
  displayName: 'Install dependencies'


# 4️⃣ Optional: Build Python package (only if setup.py exists)
- script: |
    if exist setup.py (
        python setup.py sdist bdist_wheel
    ) else (
        echo "setup.py not found, skipping package build"
    )
  displayName: 'Build Python package (optional)'

# 5️⃣ Deploy to Azure Web App
- task: AzureWebApp@1
  inputs:
    azureSubscription: $(azureSubscription)
    appType: 'webApp'
    appName: $(webAppName)
    package: $(packagePath)
  displayName: 'Deploy to Azure Web App'
